(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{159:function(e,t,n){e.exports=n(258)},176:function(e,t,n){},227:function(e,t,n){},229:function(e,t,n){},238:function(e,t,n){},240:function(e,t,n){},242:function(e,t,n){},258:function(e,t,n){"use strict";n.r(t);var a=n(11),r=n(0),c=n.n(r),i=n(12),l=n.n(i),o=n(319),u=n(322),s=n(325),m=n(309),d=n(321),p=n(310),f=n(305),b=n(117),g=n(91),E=Object(r.createContext)({currentUser:{_id:"5e705940f4ad1b0930fbebd2",name:"18901520980",email:"18901520980",picture:"/avatar/my.jpg"},isAuth:!0,draft:null,pins:[],currentPin:null,friend:null}),O={mapWrapper:{width:"100%",height:"100%",overflow:"hidden"}},h=function e(t,n,a){Object(b.a)(this,e),this.position={longitude:t,latitude:n},this._id=a},v=Object(r.memo)(function(e){var t=e.setInput,n=e.thePin,i=Object(r.useContext)(E),l=i.state,o=i.dispatch,u=Object(r.useMemo)(function(){var e={position:null,pins:null};if(n||l.friend){if(n&&!l.friend)e.position={longitude:n.longitude,latitude:n.latitude};else if(!n&&l.friend)if(0===l.friend.length)e.pins=[];else{var t=l.friend[l.friend.length-1];e.position={longitude:t.longitude,latitude:t.latitude},e.pins=l.friend.map(function(e){return new h(e.longitude,e.latitude,e._id)})}}else;return e},[n,l]),s=u.position,m=u.pins,d=Object(r.useState)(s||{longitude:116.123465,latitude:39.456787}),p=Object(a.a)(d,1)[0],f=Object(r.useState)(function(){return s?s&&!m?[s]:m:[]}),b=Object(a.a)(f,2),v=b[0],j=b[1],y=Object(r.useRef)(null),x=Object(r.useRef)(null),C=Object(r.useCallback)(function(e){var t=e.lng,n=e.lat;m||setTimeout(function(){return j([{position:{longitude:t,latitude:n}}])},100)},[x,j,m]),k=Object(r.useCallback)(function(e){return C(e.lnglat)},[C]);Object(r.useEffect)(function(){return function(){return!!x.current&&x.current.off("click",k)}},[]);var S=Object(r.useMemo)(function(){return{mapEvents:{created:function(e){x.current=e,e.on("click",k)}},markersEvents:{created:function(e){return y.current=e},click:function(e,n){if(m){var a=n.getExtData()._id;o({type:"SET_PIN",payload:a})}t(e)}}}},[t,o,m]),w=S.mapEvents,N=S.markersEvents;return c.a.createElement("div",{style:O.mapWrapper},c.a.createElement(g.Map,{version:"1.4.15",amapkey:"f1ecd6bbac5b4c7f23d9c696bea42e9b",events:w,useAMapUI:!0,center:p,zoom:11,plugins:["ToolBar"]},v.length>0&&c.a.createElement(g.Markers,{markers:v,events:N})))}),j=n(75),y=n.n(j),x=(n(176),n(20)),C=n.n(x),k=n(35),S=n(118),w=n.n(S);function N(e){var t=new FormData;return t.append("file",e),t.append("upload_preset","geopins"),t.append("cloud_name","denrebenok"),w.a.post("https://api.cloudinary.com/v1_1/denrebenok/image/upload",t).then(function(e){return e.data.url})}var I=function(){var e=Object(k.a)(C.a.mark(function e(t){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(t.map(function(e){return N(e)})).then(function(e){return e.filter(function(e){return!!e})});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),_=n(302),P=n(295),T=n(298),R=n(316),A=n(301),D=n(127),W=n.n(D),L=n(124),F=n.n(L),z=n(74),M=n.n(z),G=n(128),U=n.n(G),$=n(62),B="http://121.41.131.227:4000/graphql",q=function(){var e=Object(r.useContext)(E).state,t=Object(r.useMemo)(function(){return!!e.currentUser&&e.currentUser.name},[e.isAuth]);return new $.GraphQLClient(B,{headers:{authorization:t}})},J=n(300),X=n(299),Y=n(297),Q=n(119),H=n.n(Q),V=n(123),Z=n.n(V),K=n(31),ee=n(122),te=function(e,t){var n=0;return t.forEach(function(t){e.has(t)&&e.get(t)&&++n}),n},ne=function(e){var t=[];return e.forEach(function(e,n){n.toString().includes("file")&&t.push(e)}),t},ae={uploaderWrapper:{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap"},uploader:{position:"relative",display:"flex",justifyContent:"center",alignItems:"center",width:"40vw",maxWidth:"300px",height:"200px",borderRadius:"6px",marginTop:"15px",border:".5px solid #595959"},img:{width:"100%",height:"100%"},clearIcon:{position:"absolute"}},re=Object(r.memo)(function(e){var t=e.idx,n=e.changeImages,i=e.imagesRef,l=Object(r.useState)(function(){var e=i.current;return e.has(t)&&e.get(t)?e.get(t):null}),o=Object(a.a)(l,2),u=o[0],s=o[1],m=Object(r.useCallback)(function(e){!function(e,t){if(/image\/\w+/.test(e.type)){var n=new FileReader;n.onload=function(n){console.log(n),t(n.target.result,null,e)},n.readAsDataURL(e)}else t(null,"\u6587\u4ef6\u5fc5\u987b\u4e3a\u56fe\u7247\uff01")}(e.target.files[0],function(e,a,r){a?console.error(a):(n(t,e),s(e),i.current.set("file"+t,r))})},[t,s,i]),d=Object(r.useCallback)(function(){n(t,null),s(null),i.current.delete("file"+t)},[t,s,i]);return c.a.createElement("div",{style:ae.uploader},u?c.a.createElement(c.a.Fragment,null,c.a.createElement("img",{src:u,style:ae.img,alt:t}),c.a.createElement("div",{style:ae.clearIcon,onClick:d},c.a.createElement(Z.a,{style:{color:"#69696959",fontSize:50}}))):c.a.createElement("div",null,c.a.createElement("input",{accept:"image/*",id:"image"+t,style:{display:"none"},type:"file",onChange:m}),c.a.createElement("label",{htmlFor:"image"+t},c.a.createElement(H.a,{style:{fontSize:50,color:ee.a[400]}}))))}),ce=[0,1,2,3];var ie=Object(r.memo)(function(e){var t=e.isOpen,n=e.imagesRef,a=e.imagesCount,i=e.setImagesCnt,l=e.toggle,o=Object(K.a)(),u=Object(P.a)(o.breakpoints.down("sm")),s=Object(r.useCallback)(function(e,t){var a=n.current;t?a.set(e,t):a.delete(e),i(te(a,ce))},[n,i]);return c.a.createElement("div",null,c.a.createElement(d.a,{fullScreen:u,open:t,onClose:l,"aria-labelledby":"responsive-dialog-title"},c.a.createElement(Y.a,{id:"responsive-dialog-title"},0===a?"You can upload images here":"You have uploaded "+a+" images"),c.a.createElement(X.a,{style:ae.uploaderWrapper},ce.map(function(e){return c.a.createElement(re,{key:e,idx:e,changeImages:s,imagesRef:n})})),c.a.createElement(J.a,null,c.a.createElement(A.a,{onClick:function(){return l()},color:"primary"},"I Got Finished"))))}),le=Object(_.a)(function(e){return{form:{display:"flex",flexDirection:"column",justifyContent:"space-around",alignItems:"center",paddingBottom:e.spacing(.2)},contentField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"95%"},input:{display:"none"},alignCenter:{display:"flex",alignItems:"center"},iconLarge:{fontSize:40,marginRight:e.spacing(1)},leftIcon:{fontSize:20,marginRight:e.spacing(1)},rightIcon:{fontSize:20,marginLeft:e.spacing(1)},button:{marginTop:e.spacing(1),marginBottom:e.spacing(1),marginRight:e.spacing(1),marginLeft:0}}}),oe=Object(r.memo)(function(e){var t=e.PinPos,n=e.togglePannel,i=le(),l=Object(P.a)("(max-width: 500px)"),o=q(),u=Object(r.useState)(""),s=Object(a.a)(u,2),m=s[0],d=s[1],p=Object(r.useState)(0),f=Object(a.a)(p,2),b=f[0],g=f[1],E=Object(r.useState)(""),O=Object(a.a)(E,2),h=O[0],v=O[1],j=Object(r.useState)(!1),y=Object(a.a)(j,2),x=y[0],S=y[1],w=Object(r.useState)(!1),N=Object(a.a)(w,2),_=N[0],D=N[1],L=Object(r.useRef)(new Map),z=Object(r.useCallback)(function(){d(""),g(0),v("")},[d,g,v,n]),G=Object(r.useCallback)(function(){var e=Object(k.a)(C.a.mark(function e(a){var r,c;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a.preventDefault(),S(!0),e.next=5,I(ne(L.current));case 5:return r=e.sent,console.log(r),c={title:m,image:r||[],content:h,latitude:t.lat,longitude:t.lng},e.next=10,o.request("\n  mutation($title: String!, $image: [String!], $content: String!, $latitude: Float!, $longitude: Float!) {\n    createPin(input: {\n      title: $title,\n      image: $image,\n      content: $content,\n      latitude: $latitude,\n      longitude: $longitude\n    }) {\n      _id\n      createdAt\n      title\n      image\n      content\n      latitude\n      longitude\n      author {\n        _id\n        name\n        email\n        picture\n      }\n    }\n  }\n",c);case 10:S(!1),z(),n(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),S(!1),console.error("Error creating pin ",e.t0);case 19:case"end":return e.stop()}},e,this,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),[L,h,S,t,n,m]),$=Object(r.useCallback)(function(){D(!_)},[D,_]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(ie,{isOpen:_,imagesCount:b,setImagesCnt:g,imagesRef:L,toggle:$}),c.a.createElement("form",{className:i.form},c.a.createElement(T.a,{className:i.alignCenter,component:"h2",variant:"h4",color:"secondary"},c.a.createElement(F.a,{className:i.iconLarge})," Pin Location"),c.a.createElement("div",null,c.a.createElement(R.a,{name:"title",label:"title",placeholder:"Insert pin title",onChange:function(e){return d(e.target.value)}}),c.a.createElement(A.a,{style:{color:b>0&&"green"},component:"span",size:"small",className:i.button,onClick:$},c.a.createElement(W.a,null),b)),c.a.createElement("div",{className:i.contentField},c.a.createElement(R.a,{name:"content",label:"Content",multiline:!0,rows:l?"3":"6",margin:"normal",fullWidth:!0,variant:"outlined",onChange:function(e){return v(e.target.value)}})),c.a.createElement("div",null,c.a.createElement(A.a,{onClick:z,className:i.button,variant:"contained",color:"primary"},c.a.createElement(M.a,{className:i.leftIcon}),"Discard"),c.a.createElement(A.a,{type:"submit",className:i.button,variant:"contained",color:"secondary",disabled:!m.trim()||!h.trim()||0===b||x,onClick:G},"Submit",c.a.createElement(U.a,{className:i.rightIcon})))))}),ue=n(326),se=n(129),me=n.n(se),de=Object(_.a)(function(e){return{form:{display:"flex",justifyContent:"start",alignItems:"center"},input:{flex:"1",margin:"0 5px",fontSize:"14px"},clearButton:{padding:0,color:"red"},sendButton:{padding:0,color:e.palette.secondary.dark}}}),pe=Object(r.memo)(function(){var e=q(),t=Object(r.useContext)(E).state,n=de(),i=Object(r.useState)(""),l=Object(a.a)(i,2),o=l[0],u=l[1],s=Object(r.useCallback)(Object(k.a)(C.a.mark(function n(){var a;return C.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return a={pinId:t.currentPin._id,text:o},n.next=3,e.request("\n  mutation($pinId: ID!, $text: String!) {\n    createComment(pinId: $pinId, text: $text) {\n      _id\n      createdAt\n      title\n      content\n      image\n      latitude\n      longitude\n      author {\n        _id\n        name\n      }\n      comments {\n        text\n        createdAt\n        author {\n          name\n          picture\n        }\n      }\n    }\n  }\n",a);case 3:u("");case 4:case"end":return n.stop()}},n,this)})),[u,o,e,t]);return c.a.createElement("form",{className:n.form},c.a.createElement(f.a,{onClick:function(){return u("")},disabled:!o.trim(),className:n.clearButton},c.a.createElement(M.a,null)),c.a.createElement(ue.a,{className:n.input,placeholder:"Add Comment",multiline:!0,rows:"3",value:o,onChange:function(e){return u(e.target.value)}}),c.a.createElement(f.a,{onClick:s,disabled:!o.trim(),className:n.sendButton},c.a.createElement(me.a,null)))}),fe=n(304),be=n(306),ge=n(307),Ee=n(327),Oe=n(308),he=n(130),ve=n.n(he),je=Object(_.a)(function(e){return{root:{width:"100%",backgroundColor:e.palette.background.paper,height:"200px",overflowY:"auto"},inline:{display:"inline"},item:{padding:"1px 8px"},primaryTxt:{lineHeight:"1"}}}),ye=Object(r.memo)(function(){var e=je(),t=Object(r.useContext)(E).state,n=Object(r.useMemo)(function(){if(t.currentPin.hasOwnProperty("comments"))return t.currentPin.comments;var e=t.pins.find(function(e){return e._id===t.currentPin.pinId});return console.log(e),e.comments},[t.currentPin,t.pins]);return c.a.createElement(fe.a,{className:e.root},n.map(function(t,n){return c.a.createElement(be.a,{key:n,alignItems:"flex-start",className:e.item},c.a.createElement(ge.a,null,c.a.createElement(Ee.a,{src:t.author.picture,alt:t.author.name})),c.a.createElement(Oe.a,{primary:c.a.createElement(T.a,{component:"span",variant:"body2",style:{display:"inline"},color:"textPrimary",className:e.primaryTxt},t.text),secondary:c.a.createElement(c.a.Fragment,null,c.a.createElement(T.a,{className:e.inline,component:"span",color:"textPrimary",variant:"button"},t.author.name),"\xb7 ",ve()(Number(t.createdAt))," ago")}))}))}),xe=Object(r.memo)(function(){return c.a.createElement("div",null,c.a.createElement(ye,null),c.a.createElement(pe,null))}),Ce=c.a.forwardRef(function(e,t){return c.a.createElement(m.a,Object.assign({direction:"up",timeout:"1000",ref:t},e,{mountOnEnter:!0,unmountOnExit:!0}))}),ke={inputDiaWrapper:{padding:"10px",borderRadius:"30px",height:"250px"}},Se=Object(r.memo)(function(e){var t=e.isOpen,n=e.togglePannel,a=e.clickPinPos,i=e.isAdd,l=Object(r.useContext)(E).state;return c.a.createElement(d.a,{fullScreen:!0,maxWidth:"sm",open:t,onClose:n,"aria-labelledby":"max-width-dialog-title",TransitionComponent:Ce,id:"inputDia"},c.a.createElement("div",{style:ke.inputDiaWrapper},i&&!l.friend?c.a.createElement(oe,{togglePannel:n,PinPos:a}):c.a.createElement(xe,null)))}),we=Object(r.memo)(function(e){var t=e.isOpen,n=e.setClose,i=e.thePin,l=Object(r.useState)(!1),o=Object(a.a)(l,2),u=o[0],s=o[1],m=Object(r.useRef)(!1),b=Object(r.useRef)(0),g=Object(r.useCallback)(function(e){m.current||(!u&&e.hasOwnProperty("lnglat")&&(b.current=e.lnglat),m.current=!0,s(!u),setTimeout(function(){return m.current=!1},400))},[u,s,m,b]),E=Object(r.useMemo)(function(){return!i},[i]);return c.a.createElement("div",null,c.a.createElement(d.a,{fullScreen:!0,open:t,onClose:n,TransitionComponent:Ce},c.a.createElement(p.a,null,c.a.createElement(f.a,{edge:"start",color:"inherit",onClick:n,"aria-label":"close"},c.a.createElement(y.a,null))),c.a.createElement(v,{setInput:g,thePin:i}),c.a.createElement(Se,{isOpen:u,togglePannel:g,isAdd:E,clickPinPos:b.current})))}),Ne=n(76),Ie=n.n(Ne),_e=1,Pe=2,Te=n(50),Re=n(131),Ae=n.n(Re),De=(n(227),n(93));function We(){var e=Object(Te.a)(["\n  width: ",";\n  height: 100%;\n  border-radius: 10px;\n  background: url(",") no-repeat;\n  background-size: cover;\n"]);return We=function(){return e},e}function Le(){var e=Object(Te.a)(["\n  display:flex;\n  width: ",";\n  overflow: hidden;\n  height: 100%;\n  transition: transform 1s ease;\n  border-radius: 10px;\n  transform: ",";\n\n  filter: grayscale(0.4);\n\n  &::before {\n    content: '';\n    position: absolute;\n    z-index: -1;\n    display: block;\n    width: 100%;\n    height: 100%;\n    background-image: linear-gradient(\n      to bottom,\n      rgba(99, 94, 86, 0.5),\n      rgba(99, 94, 86, 0) 30%,\n      rgba(64, 65, 66, 0) 70%,\n      rgba(33, 34, 35, 0.9)\n    );\n  }\n"]);return Le=function(){return e},e}var Fe=De.a.div(Le(),function(e){return e.wid},function(e){return"translateX(calc(-".concat(e.cur," * ").concat(e.itemWid," ))")}),ze=De.a.div(We(),function(e){return e.itemWid},function(e){return e.images[e.idx]}),Me=Object(r.memo)(function(e){var t=e.cur,n=e.itemWid,a=e.images;return c.a.createElement(Fe,{cur:t,wid:a.length+"00%",itemWid:n},a.map(function(e,t){return c.a.createElement(ze,{key:t,idx:t,itemWid:n,images:a})}))}),Ge=Object(r.memo)(function(e){var t=e.loc,n=e.lnglat;return c.a.createElement("div",{className:"content"},c.a.createElement("h2",{className:"title"},t),c.a.createElement("div",{className:"location"},c.a.createElement("span",null,n.lng),c.a.createElement("span",{className:"location_icon"},c.a.createElement(Ie.a,{fontSize:"small"})),c.a.createElement("span",null,n.lat)))}),Ue=Object(r.memo)(function(e){var t=e.cur,n=e.len,a=Object(r.useMemo)(function(){for(var e=[],t=0;t<n;t++)e.push(t);return e},[n]);return c.a.createElement("div",{className:"index-wrapper"},c.a.createElement("div",{className:"img-index"},n>1&&a.map(function(e){return c.a.createElement("div",{key:e,className:Ae()("index-item",{active:t===e})})})))}),$e=Object(r.memo)(function(e){var t=e.images,n=Object(r.useState)(0),i=Object(a.a)(n,2),l=i[0],o=i[1],u=Object(r.useRef)(null),s=Object(r.useMemo)(function(){return 100/t.length+"%"},[]);return c.a.createElement("div",{className:"my-slider",onTouchStart:function(e){e.persist(),u.current=e.changedTouches[0].clientX},onTouchEnd:function(e){e.persist();var n=e.changedTouches[0].clientX-u.current;n>20?l>0&&o(l-1):n<-20&&l<t.length-1&&o(l+1)}},c.a.createElement(Me,{cur:l,itemWid:s,images:t}),c.a.createElement(Ge,{loc:"Los Angels",lnglat:{lat:"North Lat 36",lng:"East Lng 118"}}),c.a.createElement(Ue,{cur:l,len:t.length}))}),Be=(n(229),n(134)),qe=n.n(Be),Je=n(135),Xe=n.n(Je),Ye=n(136),Qe=n.n(Ye),He=Object(r.memo)(function(e){var t=e.isAct,n=e.setPin;return c.a.createElement("div",{className:t?"back-bar active":"back-bar"},c.a.createElement("nav",{className:t?"inner active":"inner"},c.a.createElement("span",null,c.a.createElement(qe.a,null)," 22"),c.a.createElement("span",null,c.a.createElement(Xe.a,null)," 24"),c.a.createElement("span",null,c.a.createElement(Qe.a,null)," 30"),c.a.createElement("input",{type:"button",value:"Get Pos",onClick:n})))}),Ve=Object(r.memo)(function(e){var t=e.images;return c.a.createElement("div",{className:"fore-front"},c.a.createElement($e,{images:t}))}),Ze=Object(r.memo)(function(e){var t=e.setPin,n=e.item,i=Object(r.useState)(!1),l=Object(a.a)(i,2),o=l[0],u=l[1];return c.a.createElement("div",{className:"feed",onClick:function(){return u(!o)}},c.a.createElement(Ve,{images:n.image}),c.a.createElement(He,{isAct:o,setPin:t}))}),Ke=n(65),et=n(81),tt=n.n(et);function nt(){var e=Object(Te.a)(["\n  subscription {\n    pinDeleted {\n      _id\n    }\n  }\n"]);return nt=function(){return e},e}function at(){var e=Object(Te.a)(["\n  subscription {\n    pinUpdated {\n      _id\n      createdAt\n      title\n      content\n      image\n      latitude\n      longitude\n      author {\n        _id\n        name\n      }\n      comments {\n        text\n        createdAt\n        author {\n          name\n          picture\n        }\n      }\n    }\n  }\n"]);return at=function(){return e},e}function rt(){var e=Object(Te.a)(["\n  subscription {\n    pinAdded {\n      _id\n      createdAt\n      title\n      image\n      content\n      latitude\n      longitude\n      author {\n        _id\n        name\n        email\n        picture\n      }\n      comments {\n        text\n        createdAt\n        author {\n          name\n          picture\n        }\n      }\n    }\n  }\n"]);return rt=function(){return e},e}var ct=tt()(rt()),it=tt()(at()),lt=(tt()(nt()),Object(r.memo)(function(e){var t=e.dispatch;return c.a.createElement(c.a.Fragment,null,c.a.createElement(Ke.Subscription,{subscription:ct,onSubscriptionData:function(e){var n=e.subscriptionData.data.pinAdded;console.log({pinAdded:n}),t({type:"CREATE_PIN",payload:n})}}),c.a.createElement(Ke.Subscription,{subscription:it,onSubscriptionData:function(e){var n=e.subscriptionData.data.pinUpdated;console.log({pinUpdated:n}),t({type:"CREATE_COMMENT",payload:n})}}))})),ot={root:{width:"100%",maxWidth:"600px",overflowY:"auto",overflowX:"hidden"},pinItem:{height:"270px"},commentItem:{height:"90px"}},ut=Object(r.memo)(function(e){var t=e.item,n=e.setMapOpen,a=e.setPin,i=Object(r.useMemo)(function(){var e=t.hasOwnProperty("image")?_e:Pe,n=t.title;return n&&n.length>50&&(n=n.substr(0,50)+"..."),{primaryMsg:n,type:e}},[t]),l=i.primaryMsg,o=i.type,u=Object(r.useCallback)(function(){a(t),n()},[a,n,t]);return c.a.createElement(be.a,{alignItems:"flex-start",key:t._id,style:o===Pe?ot.commentItem:ot.pinItem},c.a.createElement(ge.a,null,c.a.createElement(Ee.a,{alt:"Remy Sharp",src:t.author.picture})),c.a.createElement(Oe.a,{primary:t.author.name,secondary:c.a.createElement(c.a.Fragment,null,c.a.createElement(T.a,{component:"span",variant:"body2",style:{display:"inline"},color:"textPrimary"},!!l&&l))}),o===Pe?c.a.createElement(f.a,{onClick:u,style:{justifySelf:"end"}},c.a.createElement(Ie.a,{color:"primary"})):c.a.createElement(Ze,{setPin:u,item:t}))}),st=Object(r.memo)(function(e){var t=e.setMapOpen,n=e.setPin,a=Object(r.useContext)(E),i=a.dispatch,l=a.state,o=q();Object(r.useEffect)(function(){u()},[]);var u=Object(r.useCallback)(Object(k.a)(C.a.mark(function e(){var t,n;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.request("\n  {\n    getPins {\n      _id\n      createdAt\n      title\n      image\n      content\n      latitude\n      longitude\n      author {\n        _id\n        name\n        email\n        picture\n      }\n      comments {\n        text\n        createdAt\n        author {\n          _id\n          name\n          picture\n        }\n      }\n    }\n  }\n");case 2:t=e.sent,n=t.getPins,i({type:"GET_PINS",payload:n});case 5:case"end":return e.stop()}},e,this)})),[i,o]),s=Object(r.useCallback)(function(e){n(e),i({type:"SET_PIN",payload:e})},[i]);return c.a.createElement(c.a.Fragment,null,c.a.createElement(fe.a,{style:ot.root},l.pins.map(function(e){return c.a.createElement(ut,{key:e.id,setMapOpen:t,item:e,setPin:s})})),c.a.createElement(lt,{dispatch:i}))}),mt=n(144),dt=n.n(mt),pt=n(145),ft=n.n(pt),bt={wrapper:{display:"flex",alignItems:"center",position:"fixed",left:0,right:0,top:0,height:"68px",backgroundColor:"white",fontSize:"15px",zIndex:"10"},h1:{display:"flex",justifyContent:"center",flex:1,height:"38px",fontSize:0,backgroundImage:"url(/assets/logo.jpg)",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat"},span:{padding:"0 20px"}},gt=Object(r.memo)(function(e){var t=e.addPin;return c.a.createElement("div",{style:bt.wrapper},c.a.createElement("span",{style:bt.span},c.a.createElement(dt.a,null)),c.a.createElement("div",{style:bt.h1}),c.a.createElement("span",{style:bt.span,onClick:t},c.a.createElement(ft.a,null)))}),Et=n(146),Ot=n.n(Et),ht={navigation:{display:"flex",justifyContent:"space-between",padding:"70px 10px 0px",fontSize:"12px",fontWeight:"600",alignItems:"baseline"},navigationTitle:{fontSize:"12px",margin:0},navigationCaret:{marginRight:"4px"},icon:{margin:"-7px 0"}},vt=Object(r.memo)(function(){return c.a.createElement("nav",{style:ht.navigation},c.a.createElement("h2",{style:ht.navigationTitle},"Stories"),c.a.createElement("div",null,c.a.createElement(Ot.a,{style:ht.icon}),"Watch all"))}),jt=(n(238),Object(r.memo)(function(e){var t=e.friend,n=e.select,a=Object(r.useCallback)(function(){return n(t._id)},[t]);return c.a.createElement("div",{className:"friend",onClick:a},c.a.createElement("span",{className:"friend_face",style:{backgroundImage:"url(".concat(t.picture,")")}}),c.a.createElement("span",{className:"friend_name"},t.name))})),yt=Object(r.memo)(function(e){var t=e.select,n=Object(r.useContext)(E).state,a=Object(r.useMemo)(function(){var e=[];return e.push(n.currentUser),e.push({name:"Json",_id:"5e705ac11c9d440000420f9b",picture:"/avatar/Json.jpg"}),e},[n.currentUser]);return c.a.createElement("div",{className:"friend-list-scroll"},c.a.createElement("div",{className:"friend-list"},c.a.createElement("ul",{style:{width:"".concat(65*a.length,"px")}},a.map(function(e){return c.a.createElement("li",{key:e.name},c.a.createElement(jt,{select:t,friend:e}))}))))}),xt=(n(240),{root:{width:"100%",maxWidth:"600px",margin:" 0 auto",background:"white",height:"100vh"}});var Ct=function(){var e=Object(r.useState)(!1),t=Object(a.a)(e,2),n=t[0],i=t[1],l=Object(r.useState)(null),o=Object(a.a)(l,2),u=o[0],s=o[1],m=Object(r.useContext)(E).dispatch,d=Object(r.useCallback)(function(){n&&m({type:"DESELECT_FRIEND"}),i(!n)},[n,i]),p=Object(r.useCallback)(function(){s(null),d()},[d,s]),f=Object(r.useCallback)(function(e){m({type:"SELECT_FRIEND",payload:e}),d()},[m,d]);return c.a.createElement("div",{style:xt.root},c.a.createElement(gt,{addPin:p}),c.a.createElement(vt,null),c.a.createElement(yt,{select:f}),c.a.createElement(st,{setMapOpen:d,setPin:s}),c.a.createElement(we,{isOpen:n,setClose:d,thePin:u}))},kt=n(320),St=n(5),wt=(n(242),n(324)),Nt=n(314),It={warningBg:{background:"red"}},_t=Object(r.memo)(function(e){var t=e.isOpen,n=e.close,a=e.msg;return c.a.createElement(wt.a,{style:It.warningBg,anchorOrigin:{vertical:"top",horizontal:"center"},open:t,autoHideDuration:4e3,onClose:n},c.a.createElement(Nt.a,{"aria-describedby":"message-id",message:c.a.createElement("span",{id:"message-id"},a),style:It.warningBg,action:[c.a.createElement(f.a,{key:"close","aria-label":"Close",color:"inherit",onClick:n},c.a.createElement(y.a,null))]}))}),Pt=1,Tt=2,Rt=3,At=Object(r.memo)(function(e){var t=e.setStatus,n=e.phoneNum,i=Object(r.useState)(!0),l=Object(a.a)(i,2),o=l[0],u=l[1],s=Object(r.useState)(""),m=Object(a.a)(s,2)[1],d=Object(r.useState)(60),p=Object(a.a)(d,2),f=p[0],b=p[1],g=Object(r.useState)(!1),E=Object(a.a)(g,2),O=E[0],h=E[1],v=Object(r.useRef)(),j=Object(r.useRef)(""),y=Object(r.useCallback)(function(e){var t=e.target.value.trim();4===t.length&&(m(t),x(t))},[m]),x=Object(r.useCallback)(function(e){e===v.current?t(Rt):(j.current="Sorry Wrong Verify Code",h(!0))},[v,j]),S=Object(r.useCallback)(function(){u(!1),b(60);var e=60,t=setInterval(function(){b(e-=1),0===e&&(clearInterval(t),u(!0))},1e3);w()},[u,b]),w=Object(r.useCallback)(Object(k.a)(C.a.mark(function e(){var t,a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new $.GraphQLClient(B,{headers:{authorization:n}}),e.next=3,t.request("\n  query($phoneNum: String!) {\n    verify (phoneNum:$phoneNum){\n      res\n    }\n  }\n",{phoneNum:n});case 3:a=e.sent,v.current=a.verify.res;case 5:case"end":return e.stop()}},e,this)})),[n,v]),N=Object(r.useCallback)(function(){h(!1)},[h]);return c.a.createElement("div",{style:Lt.verifyWrapper},c.a.createElement(_t,{isOpen:O,msg:j.current,close:N}),c.a.createElement(R.a,{autoFocus:!0,id:"centerText",label:"Verify Code",onChange:y}),c.a.createElement(A.a,{variant:"contained",size:"small",color:"primary",disabled:!o,onClick:S},o?"Send":f))}),Dt=Object(r.memo)(function(e){var t=e.setStatus,n=e.setPhoneNum,i=Object(r.useState)(""),l=Object(a.a)(i,2),o=l[0],u=l[1],s=Object(r.useCallback)(function(e){var t=e.target.value;u(t.trim())},[u]),m=Object(r.useCallback)(function(){n(o),t(Tt)},[o,n,t]);return c.a.createElement("div",{style:Lt.phoneInputWrapper},c.a.createElement(R.a,{autoFocus:!0,id:"centerText",label:"Phone Number",onChange:s,style:Lt.phoneNumInput}),c.a.createElement(A.a,{variant:"contained",color:"primary",disabled:0===o.trim().length,onClick:m},"Go"))}),Wt=Object(r.memo)(function(e){var t=e.onSuccess;return Object(r.useEffect)(function(){t()},[t]),c.a.createElement(c.a.Fragment,null,"Success")}),Lt={root:{height:"100vh",display:"flex",justifyContent:"center",flexDirection:"column",alignItems:"center"},phoneInputWrapper:{display:"flex",flexDirection:"column",width:"90vw",maxWidth:"300px"},phoneNumInput:{margin:"0 0 20px"},verifyWrapper:{marginTop:"20px",display:"flex",justifyContent:"space-between",alignItems:"center",width:"90vw",maxWidth:"300px"},centerText:{textAlign:"center",letterSpacing:"5px"}},Ft=Object(St.a)(Lt)(function(e){var t=e.classes,n=Object(r.useContext)(E).dispatch,i=Object(r.useState)(Pt),l=Object(a.a)(i,2),o=l[0],u=l[1],s=Object(r.useState)(""),m=Object(a.a)(s,2),d=m[0],p=m[1],f=function(){var e=Object(k.a)(C.a.mark(function e(t){var a,r,c;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new $.GraphQLClient(B,{headers:{authorization:d}}),e.next=4,a.request("\n{\n  me {\n    _id\n    name\n    email\n    picture\n  }\n}\n");case 4:r=e.sent,c=r.me,n({type:"LOGIN_USER",payload:c}),n({type:"IS_LOGGED_IN",payload:!0}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),b(e.t0);case 13:case"end":return e.stop()}},e,this,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),b=function(e){console.error("Error logging in",e),n({type:"IS_LOGGED_IN",payload:!1})},g=Object(r.useMemo)(function(){return o===Pt?c.a.createElement(Dt,{setStatus:u,setPhoneNum:p}):o===Tt?c.a.createElement(At,{setStatus:u,phoneNum:d}):o===Rt?c.a.createElement(Wt,{onSuccess:f}):void 0},[o,u,d,p]);return c.a.createElement("div",{className:t.root},c.a.createElement(T.a,{component:"h1",variant:"h3",gutterBottom:!0,noWrap:!0,style:{color:"rgb(66, 133, 244)"}},"Welcome"),g)}),zt=function(){return Object(r.useContext)(E).state.isAuth?c.a.createElement(kt.a,{to:"/"}):c.a.createElement(Ft,null)},Mt=n(148),Gt=function(e){var t=e.component,n=Object(Mt.a)(e,["component"]),a=Object(r.useContext)(E).state;return c.a.createElement(s.a,Object.assign({render:function(e){return a.isAuth?c.a.createElement(t,e):c.a.createElement(kt.a,{to:"/login"})}},n))},Ut=n(147),$t=n(26),Bt=function(e){return e.pins.filter(function(e){return e.hasOwnProperty("image")})};function qt(e,t){var n=t.type,a=t.payload;switch(n){case"LOGIN_USER":return Object($t.a)({},e,{currentUser:a});case"IS_LOGGED_IN":return Object($t.a)({},e,{isAuth:a});case"SIGNOUT_USER":return Object($t.a)({},e,{isAuth:!1,currentUser:null});case"CREATE_DRAFT":return Object($t.a)({},e,{currentPin:null,draft:{latitude:0,longitude:0}});case"UPDATE_DRAFT_LOCATION":return Object($t.a)({},e,{draft:a});case"DELETE_DRAFT":return Object($t.a)({},e,{draft:null});case"GET_PINS":return Object($t.a)({},e,{pins:a});case"CREATE_PIN":var r=a,c=e.pins.filter(function(e){return e._id!==r._id});return Object($t.a)({},e,{pins:[r].concat(Object(Ut.a)(c))});case"SET_PIN":var i=a;return"string"===typeof a&&(i=e.pins.find(function(e){return e._id===a})),Object($t.a)({},e,{currentPin:i,draft:null});case"DELETE_PIN":var l=a,o=e.pins.filter(function(e){return e._id!==l._id});if(e.currentPin)if(l._id===e.currentPin._id)return Object($t.a)({},e,{pins:o,currentPin:null});return Object($t.a)({},e,{pins:o});case"CREATE_COMMENT":var u=a,s=e.pins.map(function(e){return e._id===u._id?u:e}),m=u.comments[u.comments.length-1];return(m=JSON.parse(JSON.stringify(m))).title=m.text,m._id=u._id+u.comments.length,m.pinId=u._id,m.longitude=u.longitude,m.latitude=u.latitude,s.unshift(m),Object($t.a)({},e,{pins:s,currentPin:u});case"SELECT_FRIEND":var d=[];return Bt(e).forEach(function(e){return e.author._id===a&&d.push(e)}),Object($t.a)({},e,{friend:d});case"DESELECT_FRIEND":return Object($t.a)({},e,{friend:null});default:return e}}var Jt=n(116),Xt=n(149),Yt=n(317),Qt=new Xt.a({uri:"ws://121.41.131.227:4000/graphql",options:{reconnect:!0}}),Ht=new Jt.a({link:Qt,cache:new Yt.a});l.a.render(c.a.createElement(function(){var e=Object(r.useContext)(E),t=Object(r.useReducer)(qt,e),n=Object(a.a)(t,2),i=n[0],l=n[1];return c.a.createElement(o.a,null,c.a.createElement(Ke.ApolloProvider,{client:Ht},c.a.createElement(E.Provider,{value:{state:i,dispatch:l}},c.a.createElement(u.a,null,c.a.createElement(Gt,{exact:!0,path:"/",component:Ct}),c.a.createElement(s.a,{path:"/login",component:zt})))))},null),document.getElementById("root"))}},[[159,2,1]]]);
//# sourceMappingURL=main.acc6203a.chunk.js.map